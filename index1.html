<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>P√°gina sin t√≠tulo</title>
<meta name="generator" content="WYSIWYG Web Builder 15 - http://www.wysiwygwebbuilder.com">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link href="AE_cumple.css" rel="stylesheet">
<link href="index1.css" rel="stylesheet">
<script src="jquery-1.12.4.min.js"></script>
<script src="jquery-ui.min.js"></script>
<script>
$(document).ready(function()
{
   $("a[href*='#contact']").click(function(event)
   {
      event.preventDefault();
      $('html, body').stop().animate({ scrollTop: $('#wb_contact').offset().top }, 600, 'easeOutCubic');
   });
});
</script>
</head>
<body>
<div id="wb_LayoutGrid7">
<div id="LayoutGrid7">
<div class="row">
<div class="col-1">
<div id="Html3" style="display:inline-block;width:100%;height:100px;z-index:0">
<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Juego de Carros</title>
</head>
<body>

<div id="gameContainer">
  <canvas id="gameCanvas" width="800" height="400"></canvas>

  <div id="overlay">
    <h1 id="overlayMessage"></h1>
    <button id="btnRetry">Reintentar</button>
    <button id="btnNextLevel">Siguiente Nivel</button>
  </div>
</div>

<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");

// Sonidos
const sonidoMotor = new Audio("sounds/motor.mp3");
const sonidoChoque = new Audio("sounds/choque.mp3");
const sonidoMeta = new Audio("sounds/meta.mp3");
const sonidoAmbiente = new Audio("sounds/ambiente.mp3");
sonidoAmbiente.loop = true; sonidoAmbiente.volume = 0.2;
sonidoAmbiente.play().catch(()=>{});

// Im√°genes
const bgImg = new Image(); bgImg.src="img/background.png";
const carBodyImg = new Image(); carBodyImg.src="img/car-body.png";
const wheelImg = new Image(); wheelImg.src="img/wheel.png";
const finishImg = new Image(); finishImg.src="img/finish.png";

// Obst√°culos 3 im√°genes
const obstacleImgs = [new Image(), new Image(), new Image()];
obstacleImgs[0].src = "img/obstacle1.png";
obstacleImgs[1].src = "img/obstacle2.png";
obstacleImgs[2].src = "img/obstacle3.png";

// Variables de juego
let car, obstacles, frame, score, totalScore=0, gameOver, level=1, finishLineX;
let bgX=0, gameSpeed=4, wheelAngle=0;
const lanes = [310,390];

// INICIALIZAR
function init(resetLevel=false){
  car = {x:10, lane:1, width:260, height:80};
  obstacles = [];
  frame = 0;
  score = 0;
  gameOver = false;

  if(resetLevel){
    level = 1;
    totalScore = 0;
  }

  gameSpeed = 4 + (level-1)*0.6;
  let distance = 1500 + (level-1)*400;
  finishLineX = canvas.width + distance;

  hideOverlay();
  gameLoop();
}

// DIBUJOS
function drawBackground(){
  bgX -= 2; if(bgX <= -canvas.width) bgX = 0;
  ctx.drawImage(bgImg,bgX,0,canvas.width,canvas.height);
  ctx.drawImage(bgImg,bgX+canvas.width,0,canvas.width,canvas.height);
}

function drawCar(){
  let carY = lanes[car.lane]-car.height;
  ctx.drawImage(carBodyImg, car.x, carY, car.width, car.height);
  drawWheel(car.x+car.width-55, carY+car.height-25,22);
  drawWheel(car.x+56, carY+car.height-20,22);
}

function drawWheel(x,y,r){
  ctx.save(); ctx.translate(x,y); ctx.rotate(wheelAngle);
  ctx.drawImage(wheelImg,-r,-r,r*2,r*2);
  ctx.restore();
}

function drawObstacles(){
  obstacles.forEach(obs=>{
    ctx.drawImage(obs.img, obs.x, lanes[obs.lane]-obs.height, obs.width, obs.height);
  });
}

function updateObstacles(){
  if(frame%160===0 && obstacles.length<3){
    let lane=Math.floor(Math.random()*2);
    obstacles.push({
      x:canvas.width,
      lane: lane,
      width:60,
      height:60,
      img: obstacleImgs[Math.floor(Math.random()*obstacleImgs.length)]
    });
  }
  obstacles.forEach(obs=>obs.x -= gameSpeed);
  obstacles = obstacles.filter(obs=>obs.x+obs.width>0);
}

function reproducirMotor(){
  if(!gameOver && sonidoMotor.paused){
    sonidoMotor.loop=true; sonidoMotor.play().catch(()=>{});
  }
}

// COLISION
function verificarColision(){
  let carY = lanes[car.lane]-car.height;
  for(let obs of obstacles){
    let obsY = lanes[obs.lane]-obs.height;
    if(car.x < obs.x+obs.width && car.x+car.width > obs.x &&
       carY+car.height > obsY && carY < obsY+obs.height){
      sonidoChoque.play();
      gameOver=true;
      totalScore += score;
      showOverlay("¬°GAME OVER!", false);
    }
  }
}

// META
function verificarMeta(){
  if(car.x+car.width > finishLineX){
    sonidoMeta.play();
    gameOver = true;
    totalScore += score;
    showOverlay("¬°NIVEL COMPLETADO!", true);
  }
}

// SCORE
function drawScore(){
  ctx.fillStyle="white";
  ctx.font="20px Arial";
  ctx.fillText("Nivel: "+level,10,20);
  ctx.fillText("Puntos nivel: "+score,10,45);
  ctx.fillText("Puntos totales: "+totalScore,10,70);
}

// FINISH LINE
function drawFinishLine(){
  ctx.drawImage(finishImg, finishLineX, 200, 80, 200);
  finishLineX -= gameSpeed;
  verificarMeta();
}

// GAME LOOP
function gameLoop(){
  if(gameOver) return;

  ctx.clearRect(0,0,canvas.width,canvas.height);
  drawBackground();
  drawCar();
  updateObstacles();
  drawObstacles();
  drawFinishLine();
  drawScore();
  verificarColision();
  reproducirMotor();
  wheelAngle += gameSpeed*0.1;
  frame++;
  score++;

  if(!gameOver) requestAnimationFrame(gameLoop);
}

// TECLADO
document.addEventListener("keydown", function(e){
  if(e.code==="ArrowUp"||e.code==="KeyW") car.lane=0;
  if(e.code==="ArrowDown"||e.code==="KeyS") car.lane=1;
});

// SWIPE M√ìVIL (con prevenci√≥n de scroll)
let touchStartY=0;
canvas.addEventListener("touchstart", e=>{
  touchStartY = e.touches[0].clientY;
  e.preventDefault();
}, {passive:false});

canvas.addEventListener("touchend", e=>{
  let touchEndY = e.changedTouches[0].clientY;
  if(touchStartY - touchEndY > 50) car.lane = 0;  // swipe arriba
  if(touchEndY - touchStartY > 50) car.lane = 1;  // swipe abajo
  e.preventDefault();
}, {passive:false});

// OVERLAY
const overlay = document.getElementById("overlay");
const overlayMessage = document.getElementById("overlayMessage");
document.getElementById("btnRetry").addEventListener("click", function(){
  overlay.style.display="none";
  init(true);
});
document.getElementById("btnNextLevel").addEventListener("click", function(){
  overlay.style.display="none";
  level++;
  init();
});

function showOverlay(msg, showNext){
  overlayMessage.textContent = msg;
  document.getElementById("btnNextLevel").style.display = showNext ? "block" : "none";
  overlay.style.display="flex";

  let maxStored = localStorage.getItem("maxScore")||0;
  if(totalScore>maxStored) localStorage.setItem("maxScore", totalScore);
}

function hideOverlay(){ overlay.style.display="none"; }

// üöÄ Iniciar juego autom√°ticamente
window.onload = () => {
  init(true);
};
</script>
</body>
</html>
</div>
</div>
</div>
</div>
</div>
<div id="Html1" style="position:absolute;left:970px;top:0px;width:100px;height:100px;z-index:5">
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0">
  </head>
<body>
  <div class="contenedor">
    <p>
  </div>
</body>
</html>

<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
  </head>
<body>
  <div class="contenedor">
    <p>
    </p>
  </div>
</body>
</html>
</div>
<div id="wb_contact">
<div id="contact">
<div class="row">
<div class="col-1">
<a id="Button1" href="./index.html" style="display:inline-block;width:202px;height:65px;z-index:1;">Atras</a>
</div>
<div class="col-2">
<a id="Button2" href="./index1.html" style="display:inline-block;width:202px;height:65px;z-index:2;">Reiniciar Juego</a>
</div>
</div>
</div>
</div>
<div id="wb_LayoutGrid5">
<div id="LayoutGrid5">
<div class="row">
<div class="col-1">
<div id="wb_Text2">
<span style="color:#FFFFFF;font-family:Arial;font-size:13px;">Copyright (c) 2025 BKStore.</span>
</div>
</div>
</div>
</div>
</div>
</body>
</html>